### 客户端开发者开发维护规范



#### 1. 需求解读
对策划文档或者禅道的任务单子进行基础解读。
#### 2. 需求分析
以自己对游戏的理解对任务中认为有疑惑的部分，或者认为存在设计缺陷设计缺漏的部分，对任务的创建者提出疑问，商榷具体方案，并且保持文档一致性。
#### 3. 代码规范
a. 原则上不允许直接继承cc.Component,所有组件继承GChild,窗口类继承GViewBase，切页界面继承GPageView。逻辑类继承ObjectWrap.继承了GViewBase或者GChild的组件，正常情况下不能重载一级重载函数即onLoad, start, onDestroy等。需要使用二级重载接口 onGLoad, onGDestory等。

b. 注释，老生常谈问题，原则上需要对所有语义不明的变量以及函数进行注释。另外对坑比较明显的内容需要特别重视注释。更重要的是需求变更后修改后对应注释的修改，这个非常容易忽略，导致注释和代码背道而驰！

c. 遵循框架的设计通常一个模块设计涉及到：
    i. SData(StaticData) 策划静态数据，
    ii. RData(RuntimeData) 服务端下发的热数据，
    iii. Logic 逻辑管理，
    vi. Views 相关的UI.

d. 变量函数命名： protect/private成员变量以 “_”开头，首字母小写驼峰命名。pubic 首字母小写驼峰命名。

e. 事件函数命名： 网络事件 “_onRPC”+ [RouteName]；客户端事件 “_onCMSG”+ [事件名称]，事件一般声明为protect成员函数。

f. 列表：列表控件在不确定列表数量的情况下，或者列表数据超出单屏以上的数据时，需要采用复用列表控件即GListView,有动态计算需求的采用GScrollView.

g. UI按钮： Transition = scale, ZoomScale = 0.9, Duration = 0.1的设置。

h. Label,RichText,WDLabel,WDRichText: 没有特殊说明，需要使用CacheMode = CHAR，字号需要根据实际需求和规范确定，不明确的地方需要及时反馈;

i. 颜色：项目中用到的颜色，请通过“项目/色彩管理工具”添加，导出后在JXColor中获取对应的颜色使用，不可擅自添加规范外的颜色。
（PS: 之前富文本带的颜色需要添加到该规范中，现在将限制修改为，策划配置的颜色将不在进行色彩管控，但是程序使用在富文本中的颜色依然需要添加到色彩管理工具中）

j. 物品（JXItem）：游戏内的物品数据实例都走RJXItem, UI实例走 JXItem.物品系统包括背包，奖励，消耗，货币等。以二进制掩码作为样式参数。不能额外添加相关的UI扰乱规范。

k. 提前校验：在向服务端发送协议之前，在尽可能的条件下，提前对条件进行校验，一方面减轻服务端压力，另一方面便于优化体验。

l. 发包,收包: 正常发包需要进行showWait转菊花等待服务端回报；服务端回包之后需要调用closeWait关闭菊花，方可进行下一步操作,一是为了防止重复发包，二是为了双端数据不同步引起的异常。（除非是静默协议，或者有特别说明，或者有其他表现形式的）。

m. 事件监听： 事件总共分为三个优先级：为别为PRIORITY_NET = 1001, PRIORITY_DATA = 2001, PRIORITY_VIEW = 3001;分别对应网络层，数据层，视图层（没有逻辑层是历史遗留问题，可以视实际情况使用数据层，或者视图层或者视图2层）。

n. protocol: 关于submodule同步的时候执行./client_sync.git.bat.


#### 4. 关于资源管理
a. AssetImpl 资源加载参考 关于资源加载的修改以及一些重要接口的变更[前往查看](./README-GLOADER-CHANGE.md).

b. 多语言文本：多语言有静态动态2种，如果无需代码设置的对语言需要挂载对应类型的多语言组件。动态多语言又分为程序和策划多语言文本。程序多语言使用“L”接口，策划配置的多语言使用 “GameMgr.i18n.L”接口。

c. 多语言资源: 多语言资源需要放到resources/i18n中对应的多语言目录中。

d. 图集工程：项目中需要用到的资源，需要根据模块，使用性质等在SVN图集工程中TXPackerProj进行分类处理。然后需要打成图集的打成图集，原则上图片单边大于512的不进入图集，以散图的形式存在。图集工程也分为i18n和通用目录.需要打集的资源目录为./res;i18n资源在./res/i18中。不需要打集的资源非i18n在目录 unpack中，i18n资源在unpacki18n中。(i18n资源定义：在不同语言环境下，会使用不同的资源).最基本的判断依据是图片资源中出现非数字类型的文本。

e. 关于多语言合并：多语言文本在发布的时候会进行一次合并，会将策划的多语言表+服务端的多语言错误信息合并。
客户端的多语言js再构建的时候会转成json。所以出包的时候如果服务端有对错误码进行更新，或者策划有对多语言表格更新，则需要执行策划表格目录下“合并服务端错误码.bat”脚本。

f. 正式出包的时候会有一个资源同步的脚本，目前还都是手动同步。

#### 5.关于任务规范
a. 任务相关改动需要送达对应策划，美术，服务端相关人员。

b. 对已完成的内容进行更改，需要注意对周边内容的影响，需要测试完善之后才能进入任务转交。

c. 完成的内容中如果存在UI相关的内容，先以发实际效果图到项目群中进行简单的初审，通过之后才能进入任务转交。

d. 开发过程中有疑问的，标准和需求冲突的，美术和策划相悖的部分，需要及时向相关人员提出，商榷解决方案，并且入档记录。

e. 对于接手他人模块或代码，进行优化或者BugFix的时候，一定要报以十分严谨的态度。必须要以熟悉整个代码为基础条件进行修改，并且修改完成后要进行充分的测试，方可交接任务。

f. 关于复用性。在各个模块的任务实现中通常会出现复用内容。这时候需要对能复用的部分进行归纳整理。第一种复用整理是以经验为基础，判断出是否回存在高频复用，进行提前整理。另外一种是，当游戏中相同的需求出现2，3次以上时，就需要考虑整理复用。


#### 6. 规范版本
这是第一版简单的规范版本。ver.0.0.1,将会进行持续性的补充。

    

